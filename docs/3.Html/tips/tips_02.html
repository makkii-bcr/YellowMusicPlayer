<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>YellowMusicPlayer</title>
  <link rel="stylesheet" type="text/css" href="../s.css">
  <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
 </head>
 <body>
  <h1>
   <img src="../res/icon.png" align="top">
   &nbsp;Tips・その他&nbsp;
   <img src="../res/icon.png" align="top">
  </h1>
  <hr>
  <h2>YellowMusicPlayerの設定を変える</h2>
  filesフォルダに、「YMPConfig.txt」というファイルを作ると<br>
  YellowMusicPlayerの設定を変更できます。<br>
  <br>
  下記の設定ができます。<br>
  <ul>
   <li><s>Player.exeのファイル名を変えても、Tonyu強制終了にYellowMusicPlayerが自動終了できるようにする</s><br>
       <font color="#FF0000">※ ver2.10より設定を省略しても自動終了できるようになりました</font></li>
   <li>DirectMusicの ON / OFF を設定</li>
   <li>他のMidiPlayer, OggPlayer の動作を再現</li>
   <li>ファイルの読み込み頻度の調節</li>
   <li><s>Midiファイルをメモリに保持するかしないか設定</s><br>
       <font color="#FF0000">※ ver2.20よりこの機能は廃止</font></li>
  </ul>
  ※ Tonyu開発環境版に導入したYellowMusicPlayerの設定を変える場合は、<br>
  　　Tonyu.exeが入っているフォルダのUsrフォルダに、filesフォルダを作り<br>
  　　その中に、YMPConfig.txtを作成してください<br>
  <br>
  MusicPlayer起動時にこの設定が適応されます。（起動中に設定を変更できない）<br>
  <br>
  <br>
  <dl>
   <dt>１行目(省略可能)</dt>
   <dd>
    実行ファイル(Player.exe または Tonyu.exe)の名前を変えた時は、そのファイル名を記述してください（例：「自作ゲーム.exe」）<br>
    実行ファイルの名前を変えていない場合は、何も記述しなくていいです。<br>
    <br>
    <font color="#FF0000">※ ver 2.10から、実行ファイル名の名前を変えた時、設定しなくても自動的に終了できるようになりました。<br>
    　 ここで指定した実行ファイルを優先して監視する仕様になりました。<br>
    　 実行ファイルの名前を変えた場合、かつ、exeファイルがTonyu実行ファイルの場所に複数ある場合に、有用な機能です。</font><br>
    
   </dd>
   <br>
   <dt>２行目(省略可能)</dt>
   <dd>
    Midiの演奏にDirectMusicを使うか使わないかを制御します。<br>
    DirectMusicがOFFの場合は、Windowsで設定されているMidiデバイスを使用します。<br>
    <br>
    <dl>
     <dt>0（デフォルトの設定）：</dt>
     <dd>
      Windows 98、Me、Windows 2000、XPではDirectMusicを使いません<br>
      Windows Vista、7、8、8.1、10ではDirectMusicを使います<br>
     </dd>
     <dt>1：</dt>
     <dd>全てのOSでDirectMusicを使います</dd>
     <dt>2：</dt>
     <dd>全てのOSでDirectMusicを使いません</dd>
    </dl>
    <br>
    <dd>
     <s>※ Windows 98SE で動作確認したところ、DirectMusicを使った場合、<br>
     　　YellowMusicPlayerがフリーズしたり、システムがフリーズすることがありました。<br>
     　　安定性を考慮して、デフォルトの設定では9x系のOSではDirectMusicをOFFにするようにしています。</s><br>
     <font color="#FF0000">※ ver2.34から、Windows XP以前では、デフォルトの設定ではDirectMusicをOFFにするようにしました。<br>
     　　XP以前では、DirectMusicをONするとOFFにしている時よりも、Midiの音量が小さく聞こえるため<br>
     　　効果音とのバランスが悪くなると思い、仕様を変更しました。</font><br>
     ※ DirectMusicがOFFで、Midiデバイスに「TiMidity++」を設定している場合、<br>
     　　Midiの音色が全てピアノになることがあります。<br>
     <br>
     Windows Vista, 7, 8, 8.1, 10 では、ＰＣによってDirectMusicの準備に時間がかかることがあります。（時間がかからないwin7ＰＣもある）<br>
     DirectMusicをOFFにすることで、YellowMusicPlayerの起動が早くなります。<br>
     しかし、DirectMusicを使った時のメリットも失うことになるので、そこも考慮したほうがいいです。<br>
     <br>
     ゲームでMidiを使わない（Oggのみ再生する）場合はDirectMusicは使わないので、OFFにすると起動が速くなります。
     <dl>
      <dt>DirectMusicを使うことによるメリット</dt>
      <dd>・標準Midiデバイスの音源より音がきれい</dd>
      <dd>・Vista, 7, 8, 8.1, 10 では標準Midiデバイスの音源より音がしっかり鳴る（とくにリズムパート(ドラム音など)がちゃんと鳴るようになる）</dd>
      <dd>・反応が速い</dd>
      <dd>・Midi演奏中に、他のMidiに切り換えるときの、切り替えが速い</dd>
      <dd>・どのＰＣでも音源が変わらないので、同じ音で鳴らせる<br>
          （標準Midiデバイスの場合は、ＰＣによってデバイスが違う可能性があるので音が変わることがあります）</dd>
     </dl>
     </ul>
    </dd>
   </dd>
   
   <dt>３行目(省略可能)</dt>
   <dd>YellowMusicPlayerのモードを変えることができます<br>
       他のMidiPlayer,OggPlayerの動作・仕様を再現します<br>
       <br>
       以下のプレイヤーに対応しています。<br>
       <a href="https://www.tonyu.jp/project/viewProject.cgi?mainkey=327&" target="_blank">「Tonyu Midi Litest」</a>(ver 3.01)　(by LefTonboさん)<br>
       <a href="https://www.tonyu.jp/project/viewProject.cgi?mainkey=665&" target="_blank">「MidiOggPlayer」</a>(ver 0.01)　(by ぐりーんげーむ。さん)<br>
       <a href="https://www.tonyu.jp/project/viewProject.cgi?mainkey=330&" target="_blank">「TonyuでOgg Vorbisを鳴らすサンプル」</a>(ver 0.031)　(by soyさん)<br>
       <br>
       作者がYellowMusicPlayerを、他のPlayerが使われているゲームに導入してみたかったので、勝手ながら入れた機能です<br>
       結構こだわった部分なので再現度はかなり高いと思います。<br>
       ※ DirectMusicのON/OFFまでは再現されません<br>
       　　１行目で設定してください
   <dl>
    <dt>0（デフォルトの設定）：</dt>
    <dd>YellowMusicPlayerモードになります。つまり、通常のモードです<br>
        この状態でも、ある程度は「TonyuMidiLitest」と互換性があります（完全互換するにはTonyuMidiLitestモードにしてください）<br>
        Tonyu標準の「MidiPlayer2」とは完全互換です<br>
        このモードでは、MidiとOggを同時に鳴らすことができます</dd>
    <dt>1：</dt>
    <dd>TonyuMidiLitestモードになります（ver 3.01 を再現しています）<br>
        TonyuMidiLitestでは、ループなし再生にうまく対応していないため、<br>
        １度ループあり再生をしてしまうと、全てのMidiがループ再生されます<br>
        <br>
        TonyuMidiLitestを使ったゲームに、YellowMusicPlayerを導入すると<br>
        曲がループせずに止まってしまうゲームがありました<br>
        このようなゲームでは、このモードにするといいでしょう<br>
        このようなゲーム以外は、YellowMusicPlayerモードでも正しく動作します<br>
        あと、TonyuMidiLitestではMidiの末尾がスキップされるので、そこも再現しています<br>
        <br>
        このモードでは、音量調節・テンポ変更・フェードアウト停止・一時停止・一時停止からの再開<br>
        これらの機能が使えます<br>
        このモードではOggを鳴らすことはできません<br>
        <br>
    </dd>
    <dt>2：</dt>
    <dd>MidiOggPlayerモードになります（ver 0.01 を再現しています）<br>
        MidiOggPlayerでは、Midiの再生に「midi_sig.dat」と「(Kernelフォルダの)sig」を、<br>
        Oggの再生には「ogg_sig.dat」、再生情報には「bgm_config.dat」を監視するので、<br>
        その動作を再現しました<br>
        <br>
        また、MidiOggPlayerは一度BGMを鳴らすと、同じBGMを再生しようとしてもBGMが最初から再生し直さない仕様があり<br>
        そこも再現しています<br>
        あと、ver 0.01ではOggのフェードアウト停止にうまく対応していないのですが、<br>
        このモードでは対応させています<br>
        MusicPlayerが起動した時間を記録する、「realtime.dat」の作成も再現しています<br>
        <br>
        動作を上手く再現できていない部分もあります<br>
        MidiOggPlayerは、Oggのループ後に戻る位置が再生中に変更できて即座に反映します<br>
        しかし、YellowMusicPlayerは仕様上の関係で、再生中に変更した場合８秒遅れて反映されてしまいます<br>
        （再生前に設定した場合は即座に反映されます）（再生中に変更できるのはこのモード限定です）<br>
        <br>
        このモードでは、音量調節・フェードアウト停止・一時停止・一時停止からの再開・Oggのループ後に戻る位置の指定<br>
        これらの機能が使えます<br>
        MidiとOggは同時に鳴らすことができます<br>
        <br>
        Tonyu開発環境版では「midi_sig.dat」「ogg_sig.dat」に書き込みをしてもBGMを鳴らせません<br>
        （Tonyu.exeのある場所から相対パスで求めているため）<br>
        $mplayer.play() からMidiを鳴らすことのみ可能です<br>
    </dd>
    <dt>3：</dt>
    <dd>TonyuでOgg Vorbisを鳴らすサンプルモードになります（ver 0.031 を再現しています）<br>
        Oggの部分は、TonyuでOgg Vorbisを鳴らすサンプルの動作を再現し、<br>
        Midiの部分は、YellowMusicPlayerとして動作します<br>
        <br>
        Oggを鳴らすサンプルを使っているゲームは、「test_ogg.exe」があり、同じ場所に「Program」フォルダがあり、<br>
        「Program」フォルダの中に「Kernel」「Usr」「Player.exe」などがある状態で動作します<br>
        YellowMusicPlayerをこのモードで動作させるには、<br>
        YellowMusicPlayerをKernelフォルダに置き、「Player.exe」を起動すると動作します<br>
        「Player.exe」などのフォルダ・ファイルを上の階層に移動して、「Program」フォルダを消しても動作します<br>
        <br>
        Oggを鳴らすサンプルでは、音量に対数処理をしていないので、<br>
        ボリューム値と感覚的に聞こえる音量とではバランスが合わなく感じますが、あえてそこも再現しています<br>
        <br>
        再生中の音量調節・フェードアウト停止も再現しています<br>
        ただし、Oggを鳴らすサンプルでは250ミリ秒刻みで音量が変化しますが、そこは再現せずに滑らかな音量変化にしました<br>
        YellowMusicPlayerでは15ミリ刻みで音量が変化します<br>
        <br>
        Oggを鳴らすサンプルはWavも鳴らせますが、YellowMusicPlayerでは鳴らせません<br>
        <br>
        このモードでは、Oggは音量調節・フェードアウト停止・一時停止・一時停止からの再開、<br>
        MidiはYellowMusicPlayerの機能が使えます<br>
        Oggの再生時間や情報などを取得することもできます<br>
        MidiとOggは同時に鳴らすことができます<br>
        <br>
        Tonyu開発環境版ではOggを鳴らせません（Tonyu.exeのある場所から相対パスで求めているため）<br>
        Midiは鳴らすことができます<br>
    </dd>
   </dl>
   <dt>４行目(省略可能)</dt>
   <dd>YellowMusicPlayerがファイルを読み込む頻度を調節できます。<br>
       ここでいうファイルとは、どのMidi, Oggを鳴らすのかをMusicPlayerに知らせるために、<br>
       Tonyuから書き込まれるファイルのことです。（「sig」「ogg_sig.dat」「eff_midi.txt」などのファイル）<br>
       それらのファイルの内容が変わったのかをチェックする頻度を調節できるということです。<br>
       <br>
       デフォルトでは読み込む頻度が、15ミリ秒毎と高めに設定されているので、頻度を低くしたい時は値を大きくしてください<br>
       頻度を低くすると、CPU使用率を減らすことができます。<br>
       Tonyuとのファイルの読み書きの衝突も少なくなり、Midi,Oggが再生されないバグも少なくなるかもしれません。<br>
       しかし、値を大きくするとその分反応が遅くなります。<br>
       <br>
       タイミングをシビアに求めるゲーム以外は、この値を3とか5とかにしても遅れを感じないと思います。
    <dl>
     <dt>0（デフォルトの設定）：</dt>
     <dd>15ミリ秒ごとにファイルを読み込みます。</dd>
     <dt>1～100：</dt>
     <dd>(15 * (４行目の値 + 1))ミリ秒ごとにファイルを読み込みます。</dd>
    </dl>
   </dd>
  </dl>
  <br>
  <h3>例１</h3>
  [YMPConfig.txt]<br>
<pre>

2
1
2
</pre>
  DirectMusicをOFFにして、TonyuMidiLitestモードで動作します。<br>
  ファイルの読み込み頻度は、(15 * (2 + 1)) = 45ミリ秒ごとになります。<br>
  <br>
  <h3>例２</h3>
  [YMPConfig.txt]<br>
<pre>

0
2
</pre>
  DirectMusicのON/OFFはデフォルト設定で、MidiOggPlayerモードで動作します。<br>
  ファイルの読み込み頻度は、(省略したので)15ミリ秒ごとになります。<br>
  <br>
  <h3>例３</h3>
  [YMPConfig.txt]<br>
<pre>

0
0
9
</pre>
  DirectMusicのON/OFFはデフォルト設定で、YellowMusicPlayerモード（通常のモード）で動作します。<br>
  ファイルの読み込み頻度は、(15 * (9 + 1)) = 150ミリ秒ごとになります。<br>
  <br>
  <h3>例４</h3>
  [YMPConfig.txt]<br>
<pre>



1
</pre>
  空の行はデフォルト設定として認識されます。（「1」と書いているのは４行目です）<br>
  DirectMusicのON/OFFはデフォルト設定で、YellowMusicPlayerモード（通常のモード）で動作します。<br>
  ファイルの読み込み頻度は、(15 * (1 + 1)) = 30ミリ秒ごとになります。<br>
  <br>
  <h3>例５</h3>
  [YMPConfig.txt]<br>
<pre>
シューティングゲーム.exe
0
3
16
</pre>
  実行ファイル名が「シューティング.exe」であることを認識し、Tonyuが強制終了してもYellowMusicPlayerは自動終了できます。<br>
  DirectMusicのON/OFFはデフォルト設定で、TonyuでOgg Vorbisを鳴らすサンプルモードで動作します。<br>
  ファイルの読み込み頻度は、(15 * (16 + 1)) = 255ミリ秒ごとになります。<br>
  <br>
  <a href="../tips.html">戻る</a>
  <hr>
 </body>
</html>